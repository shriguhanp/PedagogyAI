# ReportingAgent Prompt Configuration - Deep Research Report Generation
# Design Goal: Generate rich, coherent, and comprehensive academic-level deep research reports

# Citation instruction templates
citation:
  enabled_instruction: |
    **Citation Requirements (CRITICAL)**:
       - Format: Use `[N]` format where N is the reference number from the table below
       - ONLY use reference numbers from the Citation Reference Table - do NOT invent numbers!
       - Place citations at the end of sentences or claims that use information from that source
       - DO NOT add a References section - it will be generated automatically

    **Citation Reference Table** (use these exact numbers):
    {citation_table}

    **Examples**:
       - "According to recent research [5], the method achieves..."
       - "This approach has been validated in multiple studies [3][7]."

  disabled_instruction: |
    **Citation Requirements**:
       - DO NOT add any inline citations like [1], [[1]], or [N] in the text
       - DO NOT add a References section at the end - references will be handled separately
       - Focus on content synthesis without citation markers

system:
  role: |
    You are a top-tier academic writing and content integration expert, skilled at transforming complex research findings into well-structured, insightful professional reports. Your reports should exhibit the following qualities:

    **Core Writing Philosophy**:
    1. **Depth over Breadth**: Better to deeply analyze a few key points than to superficially cover many
    2. **Argumentation over Statement**: Every point should be supported by evidence, reasoning, or examples
    3. **Structured Presentation**: Use formulas, tables, flowcharts, code, and other elements to enhance expression
    4. **Academic Rigor**: Accurately cite sources, distinguish facts from inferences, acknowledge limitations

    **Important Format Requirements**:
    - All outputs must strictly follow JSON format
    - Only output valid JSON objects, do not include any additional text, explanations, or code block markers
    - JSON must be directly parseable, cannot contain comments or format errors
    - If the output contains Markdown content, include it as a JSON string value and properly escape special characters

process:
  deduplicate: |
    Analyze the following topic list and identify duplicate or highly similar topics.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Topic List:
    {topics}

    Total Topics: {total_topics}

    **Analysis Steps:**
    1. Understand the core content and research perspective of each topic
    2. Identify semantically duplicate or highly similar topics (Note: same concept with different perspectives is NOT duplication)
    3. Keep the most representative and content-rich topics

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object, do not use ```json code block wrapper
    - Do not add any explanatory text
    - Ensure JSON format is completely valid and can be directly parsed

    Output Example (for format reference only, do not copy content):
    {{
      "duplicates": [{{"indices": [0, 3], "reason": "Semantic duplication: both discuss basic principles of XX"}}],
      "keep_indices": [0, 1, 2, 4],
      "summary": "Kept 4 complementary topics covering theoretical foundations, technical implementation, application scenarios, and frontier developments"
    }}

    **Now directly output the JSON object, do not include any other content.**

  generate_outline: |
    Generate a structured three-level heading system outline for the following research.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Research Topic: {topic}

    Research Topics (including subtopic, overview, and tool_summaries):
    {topics_json}

    Total Topics: {total_topics}

    **Outline Design Principles**:

    1. **Three-Level Heading System**:
       - Level 1 (#): Report main title
       - Level 2 (##): Major sections (Introduction, Core Sections 1-N, Conclusion)
       - Level 3 (###): Subsections within each section
       - Level 4 (####): Further subdivisions (optional, for complex sections)

    2. **Logical Structure Design**:
       - Identify logical relationships between topics: hierarchy, dependency, parallel, progression, comparison
       - Order by cognitive flow: Concept → Principles → Methods → Applications → Evaluation → Outlook
       - Ensure clear transition logic between sections

    3. **Section Design Guidelines**:
       - Each main section should have a clear research question or objective
       - Subsections should cover core dimensions of the topic
       - Instructions should specify key elements to include and presentation approach

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object, do not use ```json code block wrapper
    - Do not add any explanatory text

    Output Example (for format reference only, do not copy content):
    {{
      "title": "# Report Main Title: Precisely Express Research Topic",
      "introduction": "## Introduction",
      "introduction_instruction": "Present research background, problem motivation, research objectives, and report structure",
      "sections": [
        {{
          "title": "## 1. First Main Section Title",
          "instruction": "This section focuses on... should include principle derivation and key formulas",
          "block_id": "block_1",
          "subsections": [
            {{
              "title": "### 1.1 Subsection Title",
              "instruction": "Explain in detail... recommend using comparison tables"
            }},
            {{
              "title": "### 1.2 Subsection Title",
              "instruction": "Analyze... recommend using flowcharts"
            }}
          ]
        }}
      ],
      "conclusion": "## Conclusion and Future Directions",
      "conclusion_instruction": "Summarize core findings, research contributions, limitations, and future directions"
    }}

    **Now directly output the JSON object, do not include any other content.**

  write_introduction: |
    Write the introduction section of the research report.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Research Topic: {topic}
    Introduction Guidance: {introduction_instruction}
    Research Topics Overview: {topics_summary}
    Total Topics: {total_topics}

    **Introduction Writing Framework** (400-600 words):

    1. **Opening Statement** (Paragraph 1):
       - Start from macro background or important trends
       - Introduce core challenges or opportunities in the research field
       - Highlight the necessity and urgency of the research

    2. **Problem Focus** (Paragraph 2):
       - Clearly state the specific problems this research addresses
       - Explain limitations of existing methods or understanding
       - Introduce core research objectives

    3. **Research Scope** (Paragraph 3):
       - Outline the main dimensions covered by the research
       - Explain the logical relationships between different parts
       - Preview core findings or contributions (optional)

    4. **Structure Guide** (Paragraph 4):
       - Briefly introduce the organization of report sections
       - Help readers build reading expectations

    **Writing Requirements**:
    - Use academic but accessible language
    - Each paragraph should have a clear topic sentence
    - Natural transitions between paragraphs
    - Do not use section headings, write body content directly

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object, do not use ```json code block wrapper
    - Special characters in JSON strings (such as quotes, newlines) must be properly escaped

    Output Example:
    {{
        "introduction": "Complete introduction content (Markdown format, without heading, 400-600 words)"
    }}

    **Now directly output the JSON object, do not include any other content.**

  write_section_body: |
    Write in-depth section content based on research data.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Research Topic: {topic}
    Section Title: {section_title}
    Writing Guidance: {section_instruction}
    Data Source: {block_data}

    **Deep Writing Framework**:

    ## Step 1: In-Depth Material Analysis

    1. **Information Classification**:
       - **Core Layer**: Key definitions, core formulas, main conclusions → Must present completely
       - **Supporting Layer**: Derivation processes, experimental data, case analyses → Selectively elaborate
       - **Background Layer**: Historical evolution, related work → Briefly mention

    2. **Information Credibility Assessment**:
       - Priority: peer-reviewed papers > authoritative textbooks > technical documentation > web resources
       - Conflict handling: Note different viewpoints, or choose most recent/authoritative source

    ## Step 2: Structured Organization

    **Three-Level Heading System** (Must Follow):
    - Use `##` as the main section heading
    - Use `###` to organize sub-topics (2-4 is ideal)
    - Complex sub-topics can use `####` for further subdivision

    **Logical Architecture Patterns** (Choose the most suitable one):
    - **Deductive**: Principles → Corollaries → Applications → Validation
    - **Inductive**: Phenomena → Analysis → Patterns → Theory
    - **Comparative**: Method A vs Method B → Pros/Cons Analysis → Applicable Scenarios
    - **Problem-Oriented**: Problem → Existing Solutions → Limitations → Improvement Ideas

    ## Step 3: Multi-Modal Element Usage

    **Must selectively use the following elements based on content characteristics**:

    1. **Mathematical Formulas** (LaTeX format):
       - Inline formula: `$E = mc^2$`
       - Block formula:
         ```
         $$
         \mathcal{L} = \sum_{i=1}^{n} \ell(y_i, f(x_i)) + \lambda \Omega(f)
         $$
         ```
       - Applicable: definitions, theorems, derivations, optimization objectives, etc.

    2. **Tables** (Markdown format):
       - Applicable: multi-dimensional comparisons, parameter configurations, experimental results, classification summaries
       - Format example:
         ```
         | Method | Accuracy | Efficiency | Use Case |
         |--------|----------|------------|----------|
         | A      | 95%      | Fast       | Real-time systems |
         | B      | 98%      | Slow       | Offline analysis |
         ```

    3. **Flowcharts** (Mermaid format):
       - Applicable: algorithm flows, system architectures, decision logic, data flows
       - Format example:
         ```mermaid
         graph TD
             A[Input] --> B{{Processing}}
             B --> C[Output]
         ```

    4. **Code Blocks**:
       - Applicable: algorithm implementations, configuration examples, API calls
       - Must specify language type (python/javascript/sql, etc.)

    5. **Lists and Hierarchy**:
       - Ordered lists: steps, rankings, priorities
       - Unordered lists: features, elements, options
       - Nested lists: hierarchical relationships, classification systems

    ## Step 4: Academic Writing Standards
    {citation_instruction}

    1. **Deep Paraphrasing**:
       - Avoid direct copying, reorganize with academic language
       - Example transformation:
         - Original: "Method X works well"
         - Revised: "Experimental results demonstrate that Method X achieves significant improvement in metric Y, with a Z% increase over the baseline approach"

    2. **Argument Completeness**:
       - Each core point should have: Claim → Evidence → Analysis → Summary
       - Use appropriate transition sentences to connect paragraphs

    3. **Technical Terminology Handling**:
       - Provide definition or explanation when first mentioned
       - Can use "term (original English)" format

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object, do not use ```json code block wrapper
    - Newlines in JSON strings should use \n escape
    - Ensure JSON format is completely valid

    Output Example:
    {{
        "section_content": "## Section Title\n\nOpening paragraph...\n\n### 1.1 Subsection Title\n\nContent...\n\n### 1.2 Subsection Title\n\nContent...{citation_output_hint}"
    }}

    **Word Count Requirement**: Each section should be at least 800 words, with comprehensive and thorough discussion

    **Now directly output the JSON object, do not include any other content.**

  write_conclusion: |
    Write the conclusion section of the research report.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Research Topic: {topic}
    Conclusion Guidance: {conclusion_instruction}
    Key Findings: {topics_findings}
    Total Topics: {total_topics}

    **Conclusion Writing Framework** (500-700 words):

    1. **Research Review and Core Findings** (Paragraphs 1-2):
       - Briefly review research questions and methods
       - Systematically summarize core findings from each chapter
       - Synthesize into overall conclusions

    2. **Research Contributions and Value** (Paragraph 3):
       - **Theoretical Contributions**: Advances in domain understanding
       - **Methodological Contributions**: New methods, frameworks, or tools
       - **Practical Value**: Guidance for real-world applications

    3. **Limitations and Reflections** (Paragraph 4):
       - Honestly point out research limitations
       - Explain constraints of data, methods, or scope
       - Indicate boundaries of conclusion applicability

    4. **Future Outlook** (Paragraph 5):
       - Identify open problems to be solved
       - Propose valuable research directions
       - Outlook on field development trends

    **Writing Requirements**:
    - Conclusion should be highly summarized, avoid repeating text details
    - Demonstrate critical thinking, do not avoid limitations
    - Outlook should be specific and feasible, not generic
    - Do not use section headings, write body content directly

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object, do not use ```json code block wrapper
    - Special characters in JSON strings must be properly escaped

    Output Example:
    {{
        "conclusion": "Complete conclusion content (Markdown format, without heading, 500-700 words)"
    }}

    **Now directly output the JSON object, do not include any other content.**

  # New: Subsection writing prompt (for Level 3 heading content)
  write_subsection: |
    Write subsection content based on parent section context.

    **Important: You must only output a valid JSON object, do not include any other text, explanations, or code block markers.**

    Research Topic: {topic}
    Parent Section Title: {parent_section_title}
    Subsection Title: {subsection_title}
    Writing Guidance: {subsection_instruction}
    Related Data: {subsection_data}

    **Writing Requirements**:

    1. **Content Positioning**:
       - Focus on the specific topic of the subsection
       - Maintain logical coherence with the parent section
       - Avoid content overlap with other subsections

    2. **Depth Requirements**:
       - Provide specific technical details or case analyses
       - Appropriately use formulas, tables, charts, and other elements
       - Arguments should be well-reasoned and evidence-based

    3. **Format Standards**:
       - Use `###` as subsection heading
       - Can use `####` for further subdivision (optional)
       - Clear paragraphs with distinct logic

    **Output Format Requirements (Strictly Follow):**
    - Only output JSON object
    - Newlines in JSON strings should use \n escape

    Output Example:
    {{
        "subsection_content": "### Subsection Title\n\nContent...\n\n#### Sub-topic (optional)\n\nContent..."
    }}

    **Word Count Requirement**: Each subsection should be 300-500 words

    **Now directly output the JSON object, do not include any other content.**
