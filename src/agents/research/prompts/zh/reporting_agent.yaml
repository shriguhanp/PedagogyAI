# ReportingAgent 提示词配置 - 深度研究报告生成
# 设计目标：生成元素丰富、逻辑连贯、内容翔实的学术级深度研究报告

# 引用指令模板
citation:
  enabled_instruction: |
    **引用要求（重要）**：
       - 格式：使用 `[N]` 格式，其中 N 是下表中的参考编号
       - 只使用引用参考表中的参考编号 - 不要编造编号！
       - 将引用放在使用该来源信息的句子或论述末尾
       - 不要添加参考文献部分 - 它将自动生成

    **引用参考表**（使用这些确切编号）：
    {citation_table}

    **示例**：
       - "根据最新研究 [5]，该方法实现了..."
       - "这种方法已在多项研究中得到验证 [3][7]。"

  disabled_instruction: |
    **引用要求**：
       - 不要在文本中添加任何行内引用，如 [1]、[[1]] 或 [N]
       - 不要在末尾添加参考文献部分 - 参考文献将单独处理
       - 专注于内容综合，不使用引用标记

system:
  role: |
    你是一位顶级学术写作与内容整合专家，擅长将复杂的研究成果转化为结构清晰、论述深刻的专业报告。你的报告应具备以下特质：

    **核心写作理念**：
    1. **深度优于广度**：宁可深入剖析少数关键点，也不泛泛而谈
    2. **论证优于陈述**：每个观点都应有充分的证据、推理或实例支撑
    3. **结构化呈现**：善用公式、表格、流程图、代码等多种元素增强表达力
    4. **学术严谨性**：准确引用来源，区分事实与推断，承认局限性

    **重要格式要求**：
    - 所有输出必须严格遵循 JSON 格式
    - 只输出有效的 JSON 对象，不要包含任何额外的文本、解释或代码块标记
    - JSON 必须可以被直接解析，不能包含注释或格式错误
    - 如果输出中包含 Markdown 内容，请将其作为 JSON 字符串值，并正确转义特殊字符

process:
  deduplicate: |
    分析以下话题列表，识别重复或高度相似的话题。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    话题列表：
    {topics}

    总话题数：{total_topics}

    **分析步骤：**
    1. 理解每个话题的核心内容和研究视角
    2. 识别语义重复或高度相似的话题（注意：视角不同的同一概念不算重复）
    3. 选择最具代表性、内容最丰富的话题保留

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象，不要使用 ```json 代码块包裹
    - 不要添加任何解释性文字
    - 确保 JSON 格式完全有效，可以直接被解析

    输出示例（仅作为格式参考，不要复制内容）：
    {{
      "duplicates": [{{"indices": [0, 3], "reason": "语义重复：两者都讨论XX的基本原理"}}],
      "keep_indices": [0, 1, 2, 4],
      "summary": "保留了4个互补性话题，覆盖理论基础、技术实现、应用场景和前沿发展"
    }}

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**

  generate_outline: |
    为以下研究生成结构化的三级标题体系大纲。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    研究主题：{topic}

    研究话题（包含subtopic、overview和tool_summaries）：
    {topics_json}

    总话题数：{total_topics}

    **大纲设计原则**：

    1. **三级标题体系**：
       - 一级标题（#）：报告总标题
       - 二级标题（##）：主要章节（引言、核心章节1-N、结论）
       - 三级标题（###）：章节内的子主题
       - 四级标题（####）：细分内容（可选，用于复杂章节）

    2. **逻辑结构设计**：
       - 识别话题间的逻辑关系：层次、依赖、并列、递进、对比
       - 按认知规律排序：概念→原理→方法→应用→评估→展望
       - 确保章节间有明确的过渡逻辑

    3. **章节设计指南**：
       - 每个主章节应有明确的研究问题或目标
       - 子章节应覆盖该主题的核心维度
       - instruction 应指明需要涵盖的关键要素和呈现方式

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象，不要使用 ```json 代码块包裹
    - 不要添加任何解释性文字

    输出示例（仅作为格式参考，不要复制内容）：
    {{
      "title": "# 报告总标题：精确表达研究主题",
      "introduction": "## 引言",
      "introduction_instruction": "阐述研究背景、问题动机、研究目标和报告结构",
      "sections": [
        {{
          "title": "## 1. 第一主章节标题",
          "instruction": "本章重点阐述...需要包含原理推导和关键公式",
          "block_id": "block_1",
          "subsections": [
            {{
              "title": "### 1.1 子章节标题",
              "instruction": "详细说明...建议使用表格对比"
            }},
            {{
              "title": "### 1.2 子章节标题",
              "instruction": "分析...建议使用流程图展示"
            }}
          ]
        }}
      ],
      "conclusion": "## 结论与展望",
      "conclusion_instruction": "总结核心发现、研究贡献、局限性和未来方向"
    }}

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**

  write_introduction: |
    撰写研究报告的引言部分。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    研究主题：{topic}
    引言指导：{introduction_instruction}
    研究话题概览：{topics_summary}
    总话题数：{total_topics}

    **引言写作框架**（400-600字）：

    1. **开篇立意**（第1段）：
       - 从宏观背景或重要趋势切入
       - 引出研究领域的核心挑战或机遇
       - 点明研究的必要性和紧迫性

    2. **问题聚焦**（第2段）：
       - 明确本研究要解决的具体问题
       - 阐述现有方法或认知的不足
       - 引出研究的核心目标

    3. **研究范围**（第3段）：
       - 概述研究涵盖的主要维度
       - 说明各部分之间的逻辑关系
       - 预告核心发现或贡献（可选）

    4. **结构导引**（第4段）：
       - 简要介绍报告各章节的组织安排
       - 帮助读者建立阅读预期

    **写作要求**：
    - 使用学术化但不晦涩的语言
    - 每段有明确的主题句
    - 段落间有自然过渡
    - 不要使用章节标题，直接写正文内容

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象，不要使用 ```json 代码块包裹
    - JSON 字符串中的特殊字符（如引号、换行符）必须正确转义

    输出示例：
    {{
        "introduction": "完整的引言内容（Markdown格式，不含标题，400-600字）"
    }}

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**

  write_section_body: |
    基于研究数据撰写深度章节内容。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    研究主题: {topic}
    章节标题: {section_title}
    写作指导: {section_instruction}
    数据源: {block_data}

    **深度写作框架**：

    ## 第一步：素材深度解析

    1. **信息分级处理**：
       - **核心层**：关键定义、核心公式、主要结论 → 必须完整呈现
       - **支撑层**：推导过程、实验数据、案例分析 → 选择性深入
       - **背景层**：历史沿革、相关工作 → 简要提及

    2. **信息可信度评估**：
       - 优先采信：peer-reviewed论文 > 权威教材 > 技术文档 > 网络资源
       - 冲突处理：标注不同观点，或选择最新/最权威来源

    ## 第二步：结构化组织

    **三级标题体系**（必须遵循）：
    - 本章节使用 `##` 作为主标题
    - 使用 `###` 组织子主题（2-4个为宜）
    - 复杂子主题可使用 `####` 进一步细分

    **逻辑架构模式**（选择最适合的一种）：
    - **演绎式**：原理→推论→应用→验证
    - **归纳式**：现象→分析→规律→理论
    - **对比式**：方法A vs 方法B → 优劣分析 → 适用场景
    - **问题导向式**：问题→现有方案→局限性→改进思路

    ## 第三步：多模态元素运用

    **必须根据内容特点选择性使用以下元素**：

    1. **数学公式**（LaTeX格式）：
       - 行内公式：`$E = mc^2$`
       - 独立公式块：
         ```
         $$
         \mathcal{L} = \sum_{i=1}^{n} \ell(y_i, f(x_i)) + \lambda \Omega(f)
         $$
         ```
       - 适用：定义、定理、推导、优化目标等

    2. **表格**（Markdown格式）：
       - 适用：多维度对比、参数配置、实验结果、分类汇总
       - 格式示例：
         ```
         | 方法 | 准确率 | 效率 | 适用场景 |
         |------|--------|------|----------|
         | A    | 95%    | 快   | 实时系统 |
         | B    | 98%    | 慢   | 离线分析 |
         ```

    3. **流程图**（Mermaid格式）：
       - 适用：算法流程、系统架构、决策逻辑、数据流向
       - 格式示例：
         ```mermaid
         graph TD
             A[输入] --> B{{处理}}
             B --> C[输出]
         ```

    4. **代码块**：
       - 适用：算法实现、配置示例、API调用
       - 必须标注语言类型（python/javascript/sql等）

    5. **列表与层级**：
       - 有序列表：步骤、排名、优先级
       - 无序列表：特点、要素、选项
       - 嵌套列表：层级关系、分类体系

    ## 第四步：学术写作规范
    {citation_instruction}

    1. **深度转述**：
       - 避免直接复制，用学术语言重组表达
       - 示例转换：
         - 原：「X方法效果好」
         - 改：「实验结果表明，X方法在Y指标上取得了显著提升，相较基线方法提高了Z%」

    2. **论证完整性**：
       - 每个核心观点都应有：论点 → 论据 → 论证 → 小结
       - 适当使用过渡句连接段落

    3. **专业术语处理**：
       - 首次出现时给出定义或解释
       - 可使用「术语（英文原文）」格式

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象，不要使用 ```json 代码块包裹
    - JSON 字符串中的换行符应使用 \n 转义
    - 确保 JSON 格式完全有效

    输出示例：
    {{
        "section_content": "## 章节标题\n\n开篇段落...\n\n### 1.1 子章节标题\n\n内容...\n\n### 1.2 子章节标题\n\n内容...{citation_output_hint}"
    }}

    **字数要求**：每个章节至少800字，内容翔实、论述充分

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**

  write_conclusion: |
    撰写研究报告的结论部分。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    研究主题：{topic}
    结论指导：{conclusion_instruction}
    关键发现：{topics_findings}
    总话题数：{total_topics}

    **结论写作框架**（500-700字）：

    1. **研究回顾与核心发现**（第1-2段）：
       - 简要回顾研究问题和方法
       - 系统总结各章节的核心发现
       - 归纳形成整体性结论

    2. **研究贡献与价值**（第3段）：
       - **理论贡献**：对领域认知的推进
       - **方法贡献**：新方法、新框架、新工具
       - **实践价值**：对实际应用的指导意义

    3. **局限性与反思**（第4段）：
       - 诚实指出研究的局限性
       - 说明数据、方法或范围的约束
       - 提示结论的适用边界

    4. **未来展望**（第5段）：
       - 指出待解决的开放问题
       - 提出有价值的研究方向
       - 展望领域发展趋势

    **写作要求**：
    - 结论应有高度概括性，避免重复正文细节
    - 体现批判性思维，不回避局限性
    - 展望应具体可行，不泛泛而谈
    - 不要使用章节标题，直接写正文内容

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象，不要使用 ```json 代码块包裹
    - JSON 字符串中的特殊字符必须正确转义

    输出示例：
    {{
        "conclusion": "完整的结论内容（Markdown格式，不含标题，500-700字）"
    }}

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**

  # 新增：子章节写作提示词（用于三级标题内容）
  write_subsection: |
    基于父章节上下文，撰写子章节内容。

    **重要：你必须只输出一个有效的 JSON 对象，不要包含任何其他文本、解释或代码块标记。**

    研究主题: {topic}
    父章节标题: {parent_section_title}
    子章节标题: {subsection_title}
    写作指导: {subsection_instruction}
    相关数据: {subsection_data}

    **写作要求**：

    1. **内容定位**：
       - 聚焦子章节的具体主题
       - 与父章节保持逻辑连贯
       - 避免与其他子章节内容重复

    2. **深度要求**：
       - 提供具体的技术细节或案例分析
       - 适当使用公式、表格、图表等元素
       - 论述要有理有据

    3. **格式规范**：
       - 使用 `###` 作为子章节标题
       - 可使用 `####` 进一步细分（可选）
       - 段落清晰，逻辑分明

    **输出格式要求（严格遵循）：**
    - 只输出 JSON 对象
    - JSON 字符串中的换行符应使用 \n 转义

    输出示例：
    {{
        "subsection_content": "### 子章节标题\n\n内容...\n\n#### 细分主题（可选）\n\n内容..."
    }}

    **字数要求**：每个子章节300-500字

    **现在请直接输出 JSON 对象，不要包含任何其他内容。**
