# ResearchAgent 提示词配置

system:
  role: |
    你是一个基于知识库的深度研究策略专家，负责系统性地从知识库中挖掘与话题相关的内容，并根据需要拓展到外部资源。

# 动态内容的指导模板
guidance:
  # 当 web_search 和 paper_search 都启用时的在线搜索指导
  online_search_both: |
    **在线搜索评估指导（web_search 和 paper_search 已启用）**：

    在评估知识充足性时，除了评估知识库内容覆盖度外，还需要考虑：

    1. **内容时效性评估**：
       - 当前知识是否包含最新发展、行业趋势和应用案例？
       - 是否需要补充最新背景信息和当前应用状态？
       - 知识库内容是否可能过时，需要最新信息补充？

    2. **知识扩展评估**：
       - 知识是否已从基础知识库内容扩展到最新发展？
       - 是否通过 web_search 补充了实时背景、行业案例和最新应用？
       - 是否通过 paper_search 补充了前沿学术研究、最新理论进展和具体研究工作？

    3. **研究完整性评估**：
       - 如果话题涉及前沿研究或最新发展，是否通过在线搜索补充了相关内容？
       - 是否形成了从知识库基础到最新发展的完整知识链？

    判断标准：
    - 如果知识库内容已充分探索 且 已通过在线搜索补充必要的实时信息/前沿研究，则视为充足
    - 如果知识库内容已充分探索 但 缺少必要的实时信息/前沿研究补充，则视为不充足
    - 如果知识库内容尚未充分探索，优先继续探索知识库，暂时忽略在线搜索

  # 当只启用 web_search 时的在线搜索指导
  online_search_web_only: |
    **在线搜索评估指导（web_search 已启用）**：

    在评估知识充足性时，除了评估知识库内容覆盖度外，还需要考虑：

    1. **内容时效性评估**：
       - 当前知识是否包含最新发展、行业趋势和应用案例？
       - 是否需要补充最新背景信息和当前应用状态？
       - 知识库内容是否可能过时，需要最新信息补充？

    2. **知识扩展评估**：
       - 知识是否已从基础知识库内容扩展到最新发展？
       - 是否通过 web_search 补充了实时背景、行业案例和最新应用？

    判断标准：
    - 如果知识库内容已充分探索 且 已通过 web_search 补充必要的实时信息，则视为充足
    - 如果知识库内容已充分探索 但 缺少必要的实时信息补充，则视为不充足
    - 如果知识库内容尚未充分探索，优先继续探索知识库，暂时忽略 web_search

  # 当只启用 paper_search 时的在线搜索指导
  online_search_paper_only: |
    **在线搜索评估指导（paper_search 已启用）**：

    在评估知识充足性时，除了评估知识库内容覆盖度外，还需要考虑：

    1. **前沿研究评估**：
       - 当前知识是否包含相关前沿学术研究和最新理论进展？
       - 是否需要补充具体研究工作、最新方法和最新发现？
       - 知识库内容是否缺乏前沿研究视角？

    2. **知识扩展评估**：
       - 知识是否已从基础知识库内容扩展到前沿研究？
       - 是否通过 paper_search 补充了前沿学术研究、最新理论进展和具体研究工作？

    判断标准：
    - 如果知识库内容已充分探索 且 已通过 paper_search 补充必要的前沿研究，则视为充足
    - 如果知识库内容已充分探索 但 缺少必要的前沿研究补充，则视为不充足
    - 如果知识库内容尚未充分探索，优先继续探索知识库，暂时忽略 paper_search

  # 灵活模式的迭代模式标准
  iteration_mode_flexible: |
    - **灵活模式（自动）**：你有自主权决定充足性。
      - 如果知识确实全面，你可以提前得出充足结论
      - 但仍需确保在得出结论前核心方面已被覆盖
      - 质量优于数量：关注有意义的覆盖，而非迭代次数

  # 固定模式的迭代模式标准
  iteration_mode_fixed: |
    - **固定模式**：在宣布充足性时要保守。
      - 在早期迭代（1-{early_threshold}）：很少得出充足结论，继续探索
      - 在中期迭代：需要有力证据证明全面覆盖
      - 仅在后期迭代（{early_threshold}+）：如果确实全面，才考虑充足
      - 目标是彻底探索，而非快速完成

process:
  check_sufficiency: |
    判断以下话题的当前知识是否充足。仅输出 JSON 对象：

    话题: {topic}
    话题概览: {overview}
    当前知识: {current_knowledge}
    迭代次数: {iteration}
    {online_search_instruction}
    {research_depth_guidance}
    {iteration_mode_criteria}

    **重要原则：深度优先于广度**

    你必须严格、系统地评估当前知识是否真正达到了"深度研究"的标准，而非仅仅"表面覆盖"。

    **评估步骤：**

    1. **明确核心要素**（至少评估以下6个维度）：
       - □ 概念定义：是否有清晰、完整的定义？
       - □ 核心原理：是否深入解释了工作机制、推导过程？
       - □ 关键公式/算法：是否包含具体的数学表达或算法步骤？
       - □ 应用场景：是否有具体的应用案例或实例分析？
       - □ 关联关系：是否探索了与其他概念/领域的联系？
       - □ 局限与发展：是否讨论了局限性、挑战或前沿发展？

    2. **严格评估覆盖情况**：
       - 统计已覆盖维度数量（至少需要覆盖4个以上维度）
       - 评估每个维度的深度（表面提及 vs 深入分析）
       - 识别关键遗漏（哪些维度完全未涉及或深度不足）

    3. **判断充足性标准**：
       - **充足**（is_sufficient=true）：满足以下**全部**条件
         ① 至少覆盖5个核心维度
         ② 每个已覆盖维度都有实质内容（非仅提及）
         ③ 迭代次数 ≥ 3（确保已进行多轮探索）
       - **不充足**（is_sufficient=false）：任一条件不满足

    输出 JSON：
    {{
      "is_sufficient": true/false,
      "covered_dimensions": ["已覆盖的维度列表"],
      "missing_dimensions": ["缺失或深度不足的维度列表"],
      "coverage_score": 0.0-1.0,
      "reason": "判断理由（具体说明覆盖情况和判断依据）"
    }}

  generate_query_plan: |
    知识不充分时，制定下一步查询计划。仅输出 JSON 对象：

    话题: {topic}
    话题概览: {overview}
    当前知识: {current_knowledge}
    迭代次数: {iteration}
    已存在话题:
    {existing_topics}

    **可用工具列表（只能使用以下工具）**：
    {available_tools}

    {tool_phase_guidance}

    **查询设计原则**：
    1. **重要**：只能从上方"可用工具列表"中选择工具，不要使用未列出的工具
    2. 每次查询应针对一个具体的知识缺口
    3. 避免与当前知识中已有内容重复
    4. 查询应具体、可执行（避免过于宽泛）
    5. 如果使用 paper_search，必须使用英文关键词

    **新话题评估**：仅当发现与主题高度相关且与现有话题完全不同的重要分支时，才建议添加新话题（score ≥ 0.85）

    输出 JSON：
    {{
      "query": "具体查询语句",
      "tool_type": "从可用工具列表中选择",
      "target_dimension": "本次查询针对的知识维度",
      "rationale": "工具选择理由和查询目标",
      "parallel": false,
      "fallback": ["rag_hybrid", "rag_naive"],
      "should_add_new_topic": false,
      "new_sub_topic": null,
      "new_overview": null,
      "new_topic_reason": null,
      "new_topic_score": 0.0
    }}
